FROM iron/base:edge

RUN echo '@edge http://nl.alpinelinux.org/alpine/edge/main' >> /etc/apk/repositories
RUN echo '@community http://nl.alpinelinux.org/alpine/edge/community' >> /etc/apk/repositories

RUN apk update && apk upgrade && apk add\
  nodejs@community \
  python \
  docker \
  g++ \
  make \
  bash \
  iptables \
  ca-certificates \
  e2fsprogs \
  && rm -rf /var/cache/apk/*

WORKDIR /tmp

ADD package.json .
RUN NODE_ENV=development npm install

ADD Dockerfile .
ADD bin ./bin
ADD scripts ./scripts

ENV DOCKER_HOST="unix:///var/run/docker.sock"
ENTRYPOINT docker build -t exobot .
